<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="MARBLE module" href="main.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>MARBLE documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="#"><div class="brand">MARBLE  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="#">
  
  
  <span class="sidebar-brand-text">MARBLE  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="main.html">MARBLE module</a></li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing.html">Postprocessing module</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Preprocessing module</a></li>
<li class="toctree-l1"><a class="reference internal" href="layers.html">Layers module</a></li>
<li class="toctree-l1"><a class="reference internal" href="geometry.html">Geometry module</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataloader.html">Dataloader module</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plotting module</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamics.html">Dynamics module</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/index.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="marble-manifold-representation-basis-learning">
<h1>MARBLE - MAnifold Representation Basis LEarning<a class="headerlink" href="#marble-manifold-representation-basis-learning" title="Link to this heading">¶</a></h1>
<p>MARBLE is a geometric deep learning method for finding latent representations of dynamical systems. This repo includes diverse examples including non-linear dynamical systems, recurrent neural networks (RNNs), and neural recordings.</p>
<p>Use MARBLE for:</p>
<ol class="arabic simple">
<li><p><strong>Deriving interpretable latent representations.</strong> Useful for interpreting single-trial neural population recordings in terms of task variables. More generally, MARBLE can infer latent variables from time series observables in non-linear dynamical systems.</p></li>
<li><p><strong>Downstream tasks.</strong> MARBLE representations tend to be more ‘unfolded’, which makes them amenable for downstream tasks, e.g., decoding.</p></li>
<li><p><strong>Dynamical comparisons.</strong> MARBLE is an <em>intrinsic</em> method, which makes the latent representations less sensitive to the choice of observables, e.g., recorded neurons. This allows cross-animal decoding and comparisons.</p></li>
</ol>
<p>The code is built around <a class="reference external" href="https://pytorch-geometric.readthedocs.io/en/latest/notes/installation.html">PyG (PyTorch Geometric)</a>.</p>
<section id="cite">
<h2>Cite<a class="headerlink" href="#cite" title="Link to this heading">¶</a></h2>
<p>If you find this package useful or inspirational, please cite our work as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@misc</span><span class="p">{</span><span class="n">gosztolaipeach_MARBLE_2025</span><span class="p">,</span>
      <span class="n">title</span><span class="o">=</span><span class="p">{</span><span class="n">MARBLE</span><span class="p">:</span> <span class="n">interpretable</span> <span class="n">representations</span> <span class="n">of</span> <span class="n">neural</span> <span class="n">population</span> <span class="n">dynamics</span> <span class="n">using</span> <span class="n">geometric</span> <span class="n">deep</span> <span class="n">learning</span><span class="p">},</span>
      <span class="n">author</span><span class="o">=</span><span class="p">{</span><span class="n">Adam</span> <span class="n">Gosztolai</span> <span class="ow">and</span> <span class="n">Robert</span> <span class="n">L</span><span class="o">.</span> <span class="n">Peach</span> <span class="ow">and</span> <span class="n">Alexis</span> <span class="n">Arnaudon</span> <span class="ow">and</span> <span class="n">Mauricio</span> <span class="n">Barahona</span> <span class="ow">and</span> <span class="n">Pierre</span> <span class="n">Vandergheynst</span><span class="p">},</span>
      <span class="n">year</span><span class="o">=</span><span class="p">{</span><span class="mi">2025</span><span class="p">},</span>
      <span class="n">doi</span><span class="o">=</span><span class="p">{</span><span class="mf">10.1038</span><span class="o">/</span><span class="n">s41592</span><span class="o">-</span><span class="mi">024</span><span class="o">-</span><span class="mi">02582</span><span class="o">-</span><span class="mi">2</span><span class="p">},</span>
      <span class="n">journal</span><span class="o">=</span><span class="p">{</span><span class="n">Nature</span> <span class="n">Methods</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p>See full documentation <a class="reference external" href="https://agosztolai.github.io/MARBLE/">here</a>.</p>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>The code is tested for CPU and GPU (CUDA) machines running Linux, Mac OSX or Windows. Although smaller examples run fast on CPU, for larger datasets, it is highly recommended that you use a GPU machine.</p>
<p>We recommend you install the code in a fresh Anaconda virtual environment, as follows.</p>
<ul class="simple">
<li><p>First, clone this repository,</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">agosztolai</span><span class="o">/</span><span class="n">MARBLE</span>
</pre></div>
</div>
<ul>
<li><p>Then, create a new Anaconda environment using the provided environment file that matches your system.</p>
<ul class="simple">
<li><p>For Linux machines with CUDA:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">environment.yml</span></code></p>
<ul class="simple">
<li><p>For Intel-based Mac:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">environment_osx_intel.yml</span></code></p>
<ul>
<li><p>For recent M1/M2/M3 Mac:</p>
<ul>
<li><p>Install cmake <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">cmake</span></code> or use the installer on the <a class="reference external" href="https://cmake.org/download/">cmake website</a></p></li>
<li><p>Create the environment</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">environment_osx_arm.yml</span></code></p>
</li>
<li><p>Activate the environment <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">MARBLE</span></code></p></li>
<li><p>Install PyTorch geometric
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements_osx_arm.txt</span></code></p></li>
</ul>
</li>
<li><p>For Windows computers:
we recommend using WSL2, which allows running a (virtual) Linux machine inside your Windows computer, which makes the installation simpler. If you have a NVIDIA GPU, WSL2 will allow you to take advantage of the GPU (an older version of WSL will not).</p>
<ul class="simple">
<li><p>Follow the <a class="reference external" href="https://learn.microsoft.com/en-us/windows/wsl/install">instructions to install WSL2</a></p></li>
<li><p>Open “Ubuntu” and install a compiler <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">update</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">gcc</span> <span class="pre">g++</span></code></p></li>
<li><p>Proceed with conda install and environment creation as described for Linux machines.</p></li>
<li><p>If you do not want to use WSL, this is possible, albeit more complicated. You need to have a working compiler (e.g. Visual Studio or <a class="reference external" href="https://www.msys2.org/">MSYS2</a>). Once installed, along with conda you can create the Python environment using <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">environment_windows_native.yml</span></code>.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>All the required dependencies are now installed. Finally, activate the environment and install it by running inside the main folder</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="n">MARBLE</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
<section id="note-on-examples">
<h3>Note on examples<a class="headerlink" href="#note-on-examples" title="Link to this heading">¶</a></h3>
<p>Running the scripts in the <code class="docutils literal notranslate"><span class="pre">/examples</span></code> folder to reproduce our results will rely on several dependencies that are not core to the MARBLE code. On Macs, run <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">wget</span></code>, which you will need to download the datasets automatically. Further dependencies will install automatically when running the example notebooks.</p>
</section>
</section>
<section id="quick-start">
<h2>Quick start<a class="headerlink" href="#quick-start" title="Link to this heading">¶</a></h2>
<p>We suggest you study at least the example of a <a class="reference external" href="https://github.com/agosztolai/MARBLE/blob/main/examples/toy_examples/ex_vector_field_flat_surface.py">simple vector fields over flat surfaces</a> to understand what behaviour to expect.</p>
<p>Briefly, MARBLE takes two inputs</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">anchor</span></code> - a list of <code class="docutils literal notranslate"><span class="pre">n_c</span> <span class="pre">x</span> <span class="pre">d</span></code> arrays, where <code class="docutils literal notranslate"><span class="pre">n_c</span></code> is the number of time points and <code class="docutils literal notranslate"><span class="pre">d</span></code> is the number of features (e.g., neurons or PCA loadings) in condition <code class="docutils literal notranslate"><span class="pre">c</span></code>. Each set of <code class="docutils literal notranslate"><span class="pre">n_i</span></code> points defines a manifold through a connected graph. For example, if you record time series observables, then <code class="docutils literal notranslate"><span class="pre">n_c</span> <span class="pre">=</span> <span class="pre">ts_1</span> <span class="pre">+</span> <span class="pre">ts_2</span> <span class="pre">+</span> <span class="pre">...</span> <span class="pre">+</span> <span class="pre">ts_nc</span></code>, where <code class="docutils literal notranslate"><span class="pre">nc</span></code> is the number of time series under a given condition.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vector</span></code> - a list of <code class="docutils literal notranslate"><span class="pre">n_c</span> <span class="pre">x</span> <span class="pre">D</span></code> arrays, where <code class="docutils literal notranslate"><span class="pre">n_c</span></code> are the same time points as in <code class="docutils literal notranslate"><span class="pre">anchor</span></code> and <code class="docutils literal notranslate"><span class="pre">D</span></code> are vector features defining the dynamics over the manifold. For dynamical systems, <code class="docutils literal notranslate"><span class="pre">D</span> <span class="pre">=</span> <span class="pre">d</span></code>, but our code can also handle signals of other dimensions. For time series observables, it is convenient to take each vector to be the difference between consecutive time points.</p></li>
</ol>
<p>Read more about <span class="xref std std-ref">inputs</span> and <span class="xref std std-ref">different conditions</span>.</p>
<p><strong>MARBLE principle: divide and conquer.</strong> The basic principle behind MARBLE is that dynamics vary continuously with respect to external conditions and inputs. Thus, if you have a large dataset with <code class="docutils literal notranslate"><span class="pre">c</span></code> conditions, it is wise to slit the data up into a list of <code class="docutils literal notranslate"><span class="pre">nxd</span></code> arrays, e.g., <code class="docutils literal notranslate"><span class="pre">anchor</span> <span class="pre">=</span> <span class="pre">[neural_states_condition_1,</span> <span class="pre">neural_states_condition_2,</span> <span class="pre">...]</span></code> and <code class="docutils literal notranslate"><span class="pre">vector</span> <span class="pre">=</span> <span class="pre">[neural_state_changes_condition_1,</span> <span class="pre">neural_state_changes_condition_2,</span> <span class="pre">...]</span></code>, rather than passing them all at once. This will ensure that the manifold features are correctly extracted. This will yield a set of <code class="docutils literal notranslate"><span class="pre">c</span></code> submanifolds, which will be combined into a joint manifold if they belong together, i.e., then are a continuation of the same system. This is possible because the learning algorithm using the features is unsupervised (unaware of these ‘condition labels’) and will find dynamical correspondences between conditions.</p>
<p>Using these inputs, you can construct a Pytorch Geometric data object for MARBLE.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">MARBLE</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">MARBLE</span><span class="o">.</span><span class="n">construct_dataset</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>The attributes <code class="docutils literal notranslate"><span class="pre">data.pos</span></code>, <code class="docutils literal notranslate"><span class="pre">data.x</span></code>, <code class="docutils literal notranslate"><span class="pre">data.y</span></code> and <code class="docutils literal notranslate"><span class="pre">data.edge_index</span></code> will hold the anchors, vector signals, condition labels and adjacencies, respectively. See <span class="xref std std-ref">other useful data attributes</span> for different preprocessing options.</p>
<p>Now, you can initialise and train a MARBLE model. Read more about <span class="xref std std-ref">training parameters</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MARBLE</span> <span class="kn">import</span> <span class="n">net</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">MARBLE</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, MARBLE operates in embedding-aware mode. To enable the embedding-agnostic mode, change the initialisation to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">MARBLE</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inner_product_features&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
<p>Read more about the embedding-aware and embedding-agnostic modes <span class="xref std std-ref">here</span></p>
<p>After you have trained your model, you can evaluate your model on your dataset or another dataset to obtain an embedding of all manifold points in joint latent space (3-dimensional by default) based on their local vector field features.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1">#adds an attribute `data.emb`</span>
</pre></div>
</div>
<p>To recover the embeddings of individual vector fields, use <code class="docutils literal notranslate"><span class="pre">data.emb[data.y==0]</span></code>, which takes the embedding of the first vector field.</p>
<p>You can then compare datasets by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MARBLE</span> <span class="kn">import</span> <span class="n">postprocessing</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">postprocessing</span><span class="o">.</span><span class="n">distribution_distances</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1">#adds an attribute `data.dist` containing a matrix of pairwise distance between vector field representations</span>
</pre></div>
</div>
<p>Finally, you can perform some visualisation</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MARBLE</span> <span class="kn">import</span> <span class="n">plotting</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">postprocessing</span><span class="o">.</span><span class="n">embed_in_2D</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1">#adds an attribute `data.emb_2D` containing a 2D embedding of the MARBLE output using UMAP by default</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1">#visualise the original vector fields over manifolds</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span> <span class="c1">#visualise embedding</span>
</pre></div>
</div>
<p>There are loads of parameters to adjust these plots, so look at the respective functions.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<p>The folder <a class="reference external" href="https://github.com/agosztolai/MARBLE/tree/main/examples">/examples</a> contains scripts for some basic examples and other scripts to reproduce the results in our paper.</p>
</section>
<section id="further-details">
<h2>Further details<a class="headerlink" href="#further-details" title="Link to this heading">¶</a></h2>
<p><span class="raw-html-md"><a name="inputs"></a></span></p>
<section id="more-on-inputs">
<h3>More on inputs<a class="headerlink" href="#more-on-inputs" title="Link to this heading">¶</a></h3>
<p>If you measure time series observables, such as neural firing rates, you can start with a list of variable-length time series under a given condition, e.g., <code class="docutils literal notranslate"><span class="pre">ts_1</span></code>, <code class="docutils literal notranslate"><span class="pre">ts_2</span></code>. We assume these are measurements from the same dynamical system, i.e., the sample points making up these trajectories are drawn from the same manifold, defining its shape <code class="docutils literal notranslate"><span class="pre">pos</span> <span class="pre">=</span> <span class="pre">np.vstack([ts_1,</span> <span class="pre">ts_2])</span></code>.</p>
<p>If you do not directly have access to the velocities, you can approximate them as <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">np.vstack([np.diff(ts_1,</span> <span class="pre">axis=0),</span> <span class="pre">np.diff(ts_2,</span> <span class="pre">axis=0)])</span></code> and take <code class="docutils literal notranslate"><span class="pre">pos</span> <span class="pre">=</span> <span class="pre">np.vstack([ts_1[:-1,:],</span> <span class="pre">ts_2[:-1,:]])</span></code> to ensure <code class="docutils literal notranslate"><span class="pre">pos</span></code> and <code class="docutils literal notranslate"><span class="pre">x</span></code> have the same length.</p>
<p><span class="raw-html-md"><a name="conditions"></a></span></p>
</section>
<section id="more-on-different-conditions">
<h3>More on different conditions<a class="headerlink" href="#more-on-different-conditions" title="Link to this heading">¶</a></h3>
<p>Comparing dynamics in a data-driven way is equivalent to comparing the corresponding vector fields based on their respective sample sets. The dynamics to be compared might correspond to different experimental conditions (stimulation conditions, genetic perturbations, etc.) and dynamical systems (different tasks, different brain regions).</p>
<p>Suppose we have the data pairs <code class="docutils literal notranslate"><span class="pre">pos1,</span> <span class="pre">pos2</span></code> and <code class="docutils literal notranslate"><span class="pre">x1,</span> <span class="pre">x2</span></code> for two conditions. Then we may concatenate them as a list to ensure that our pipeline handles them independently (on different manifolds) but then embeds them jointly in the same space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pos_list</span><span class="p">,</span> <span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">],</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">]</span>
</pre></div>
</div>
<p><span class="raw-html-md"><a name="construct"></a></span></p>
</section>
<section id="more-on-constructing-data-object">
<h3>More on constructing data object<a class="headerlink" href="#more-on-constructing-data-object" title="Link to this heading">¶</a></h3>
<p>The dataset constructor can take various parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">MARBLE</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">MARBLE</span><span class="o">.</span><span class="n">construct_dataset</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">local_gauge</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This command will do several things.</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spacing</span> <span class="pre">=</span> <span class="pre">0.03</span></code> means the points will be subsampled using farthest point sampling to ensure that features are not overrepresented. The average distance between the subsampled points will equal 3% of the manifold diameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number_of_resamples</span> <span class="pre">=</span> <span class="pre">2</span></code> resamples the dataset twice, which is particularly useful when subsampling the data using <code class="docutils literal notranslate"><span class="pre">spacing</span></code>. This will effectively double the training data because a new adjacency graph will be fit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delta</span> <span class="pre">=</span> <span class="pre">1.2</span></code> is a continuous parameter that adapts the density of the graph edges based on sample density. It is the single most useful parameter to tune MARBLE representations, with a higher <code class="docutils literal notranslate"><span class="pre">delta</span></code> achieving more ‘unfolded’ representations, as the cost of breaking things apart for too high <code class="docutils literal notranslate"><span class="pre">delta</span></code>. It has a similar effect to the minimum distance parameter in UMAP.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">local_gauge=True</span></code> means that operations will be performed in local (manifold) gauges. The code will perform tangent space alignments before computing gradients. However, this will increase the cost of the computations $m^2$-fold, where $m$ is the manifold dimension because points will be treated as vector spaces. See the example of a <a class="reference external" href="https://github.com/agosztolai/MARBLE/blob/main/examples/toy_examples/ex_vector_field_curved_surface.py">simple vector fields over curved surfaces</a> for illustration.</p></li>
</ol>
<p><span class="raw-html-md"><a name="training"></a></span></p>
</section>
<section id="training">
<h3>Training<a class="headerlink" href="#training" title="Link to this heading">¶</a></h3>
<p>You are ready to train! This is straightforward.</p>
<p>You first specify the hyperparameters. The key ones are the following, which will work for many settings, but see <a class="reference external" href="https://github.com/agosztolai/MARBLE/blob/main/MARBLE/default_params.yaml">here</a> for a complete list.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="c1">#optimisation epochs</span>
          <span class="s1">&#39;hidden_channels&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="c1">#number of internal dimensions in MLP</span>
          <span class="s1">&#39;out_channels&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
          <span class="s1">&#39;inner_product_features&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
         <span class="p">}</span>
</pre></div>
</div>
<p><strong>Note:</strong> You will want to try gradually increase ‘out_channels’ from a small number in order to ensure information compression. If you want a CEBRA-like spherical layout, set ‘emb_norm = True’.</p>
<p>Then, proceed by constructing a network object</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">MARBLE</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, launch training. The code will continuously save checkpoints during training with timestamps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="s1">&#39;./outputs&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have previously trained a network or have interrupted training, you can load the network directly as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">MARBLE</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loadpath</span><span class="o">=</span><span class="n">loadpath</span><span class="p">)</span>
</pre></div>
</div>
<p>where loadpath can be either a path to the model (with a specific timestamp, or a directory to load the latest model automatically. By running <code class="docutils literal notranslate"><span class="pre">MARBLE.fit()</span></code>, training will resume from the last checkpoint.</p>
<p><span class="raw-html-md"><a name="innerproduct"></a></span></p>
</section>
<section id="embedding-aware-and-embedding-agnostic-modes">
<h3>Embedding-aware and embedding-agnostic modes<a class="headerlink" href="#embedding-aware-and-embedding-agnostic-modes" title="Link to this heading">¶</a></h3>
<p>One of the main features of our method is the ability to run in two different modes</p>
<ol class="arabic simple">
<li><p>Embedding-aware mode - learn manifold embedding and dynamics</p></li>
<li><p>Embedding-agnostic mode - learn dynamics only</p></li>
</ol>
<p>To enable embedding-agnostic mode, set <code class="docutils literal notranslate"><span class="pre">inner_product_features</span> <span class="pre">=</span> <span class="pre">True</span></code> in training <code class="docutils literal notranslate"><span class="pre">params</span></code>. This engages an additional layer in the network after the computation of gradients, which makes them rotation invariant.</p>
<p>As a slight cost of expressivity, this feature enables the orientation- and embedding-independent representation of dynamics over the manifolds. Amongst others, this allows one to recognise similar dynamics across different manifolds. See <a class="reference external" href="https://github.com/agosztolai/MARBLE/blob/main/examples/RNN/RNN.ipynb">RNN example</a> for an illustration.</p>
</section>
</section>
<section id="troubleshooting-guide">
<h2>Troubleshooting guide<a class="headerlink" href="#troubleshooting-guide" title="Link to this heading">¶</a></h2>
<p>Training is successful when features are recognised to be similar across distinct vector fields with their own manifolds and independent proximity graphs. To achieve this, follow these useful pieces of advice (mostly general ML practises):</p>
<ol class="arabic simple">
<li><p>Check that training has converged, i.e., the validation loss is no longer decreasing.</p></li>
<li><p>Check that convergence is smooth, i.e., there are no big jumps in the validation loss.</p></li>
<li><p>Check that there is no big gap between training loss and validation loss (generalisation gap).</p></li>
</ol>
<p>Problems with the above would be possible signs your solution will be suboptimal and will likely not generalise well. In this case, try the following</p>
<ul class="simple">
<li><p>increase training time (increase <code class="docutils literal notranslate"><span class="pre">epochs</span></code>)</p></li>
<li><p>increase your data (e.g., decrease <code class="docutils literal notranslate"><span class="pre">spacing</span></code> and increase <code class="docutils literal notranslate"><span class="pre">number_of_resamples</span></code>)</p></li>
<li><p>decrease number of parameters (decrease <code class="docutils literal notranslate"><span class="pre">hidden_channels</span></code>, or decrease order, try <code class="docutils literal notranslate"><span class="pre">order=1</span></code>)</p></li>
<li><p>improve the gradient approximation (increase <code class="docutils literal notranslate"><span class="pre">delta</span></code>)</p></li>
</ul>
<p>If your data is very noisy, try enabling diffusion (<code class="docutils literal notranslate"><span class="pre">diffusion=True</span></code> in training <code class="docutils literal notranslate"><span class="pre">params</span></code>).</p>
<p>If this still does not work, check for very small or very large vector magnitudes in your dataset, filter them out, and try again.</p>
</section>
<section id="stay-in-touch">
<h2>Stay in touch<a class="headerlink" href="#stay-in-touch" title="Link to this heading">¶</a></h2>
<p>If all hope is lost, or if you want to chat about your use case, get in touch or raise an issue! We are happy to help and looking to further develop this package to make it as useful as possible.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<p>The following packages were inspirational during the development of this code:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/nmwsharp/diffusion-net">DiffusionNet</a></p></li>
<li><p><a class="reference external" href="https://github.com/Saro00/DGN">Directional Graph Networks</a></p></li>
<li><p><a class="reference external" href="https://github.com/SugiharaLab/pyEDM">pyEDM</a></p></li>
<li><p><a class="reference external" href="https://github.com/mbudnins/parallel_transport_unfolding">Parallel Transport Unfolding</a></p></li>
</ul>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="main.html">MARBLE module</a></li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing.html">Postprocessing module</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Preprocessing module</a></li>
<li class="toctree-l1"><a class="reference internal" href="layers.html">Layers module</a></li>
<li class="toctree-l1"><a class="reference internal" href="geometry.html">Geometry module</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataloader.html">Dataloader module</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plotting module</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamics.html">Dynamics module</a></li>
</ul>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="main.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">MARBLE module</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Adam Gosztolai
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">MARBLE - MAnifold Representation Basis LEarning</a><ul>
<li><a class="reference internal" href="#cite">Cite</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#note-on-examples">Note on examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quick-start">Quick start</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#further-details">Further details</a><ul>
<li><a class="reference internal" href="#more-on-inputs">More on inputs</a></li>
<li><a class="reference internal" href="#more-on-different-conditions">More on different conditions</a></li>
<li><a class="reference internal" href="#more-on-constructing-data-object">More on constructing data object</a></li>
<li><a class="reference internal" href="#training">Training</a></li>
<li><a class="reference internal" href="#embedding-aware-and-embedding-agnostic-modes">Embedding-aware and embedding-agnostic modes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting-guide">Troubleshooting guide</a></li>
<li><a class="reference internal" href="#stay-in-touch">Stay in touch</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>